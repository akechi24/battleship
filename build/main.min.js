!function t(i,e,s){function n(o,r){if(!e[o]){if(!i[o]){var d="function"==typeof require&&require;if(!r&&d)return d(o,!0);if(a)return a(o,!0);var h=new Error("Cannot find module '"+o+"'");throw h.code="MODULE_NOT_FOUND",h}var c=e[o]={exports:{}};i[o][0].call(c.exports,function(t){var e=i[o][1][t];return n(e?e:t)},c,c.exports,t,i,e,s)}return e[o].exports}for(var a="function"==typeof require&&require,o=0;o<s.length;o++)n(s[o]);return n}({1:[function(t,i,e){var s=t("./modules/Game"),n=new s($("#game"));n.init()},{"./modules/Game":5}],2:[function(t,i,e){var s=t("./Functions");i.exports=function(){var t=[],i=!1,e=!1,n=0,a=0;this.doAttack=function(){if(e){if(e&&!n){var t=s.getRandom(0,3),o=this.getCoords();switch(t){case 0:o.x--;break;case 1:o.x++;break;case 2:o.y--;break;case 3:o.y++}i=o}else if(e&&n){var t=s.getRandom(0,1);0===t&&(t=-1);var r=this.attackOn(t);if(!r)return this.doAttack();i=r}}else{var d={x:s.getRandom(0,9),y:s.getRandom(0,9)};if(!this.checkGridAround(d))return this.doAttack();if(i){var t=Math.sqrt(Math.pow(d.x-i.x,2)+Math.pow(d.y-i.y,2));if(4>t&&20>=a)return a++,this.doAttack()}a=0,i=d}return this.checkGrid(i)?i:this.doAttack()},this.attackOn=function(t){for(var i=this.getCoords();;){if(1==n?i.y+=t:i.x+=t,i.x<0||i.x>9||i.y<0||i.y>9)return!1;if(this.checkMishit(i))return!1;if(this.checkGrid(i))return i}},this.analyze=function(s){var a=i.x+10*i.y;if(s[0]&&s[1]){for(var o=0;o<s[2].length;o++)t[s[2][o]]=2;e=!1,n=0,t[a]=1}else s[0]?(e&&!n&&(n=i.x==e.x?1:i.y==e.y?2:0),e={x:i.x,y:i.y},t[a]=1):s[0]||(t[a]=2)},this.checkGrid=function(i){return i.x<0||i.x>9||i.y<0||i.y>9?!1:0===t[i.x+10*i.y]},this.checkMishit=function(i){return 2==t[i.x+10*i.y]},this.checkGridAround=function(t){return this.checkGrid({x:t.x-1,y:t.y})?!0:this.checkGrid({x:t.x,y:t.y-1})?!0:this.checkGrid({x:t.x+1,y:t.y})?!0:this.checkGrid({x:t.x,y:t.y+1})?!0:!1},this.getCoords=function(){return $.extend({},e)};for(var o=0;100>o;o++)t[o]=0}},{"./Functions":4}],3:[function(t,i,e){var s=t("./Ships"),n=t("./Functions");i.exports=function(){this.$=$("<div/>",{"class":"field"}),this.Ships;var t=[];this.deleteShip=function(t){this.Ships.reset(t),this.update()},this.setShip=function(t,i){this.Ships.set(t,this.Ships.getPosition(t,i.offset)),this.update()},this.update=function(){var i=!0;this.clear();var e=!0,s=this.Ships.getAll();for(var n in s){var a=s[n];if(a.x<0||a.y<0)e=!1;else for(var o=0;o<a.mast;o++){var r=a.rotated?a.x+o+10*a.y:a.x+10*(a.y+o);0!==t[r][0]&&(i=!1),t[r]=[1,n]}}var d=this.$.parent().find(".start-game");return e?d.removeClass("disabled"):d.addClass("disabled"),i},this.clear=function(){t=[];for(var i=0;100>i;i++)t[i]=[0,0]},this.checkCollider=function(t,i,e){var s=!1;if("undefined"==typeof(i&&e)&&(i=t.x,e=t.y,s=!0),0>i||0>e||i+(t.rotated?t.mast:1)>10||e+(t.rotated?1:t.mast)>10)return!1;for(var n=0;n<t.mast;n++)for(var a=-1;1>=a;a++)for(var o=-1;1>=o;o++)if((!s||0!=a&&0!=o)&&this.checkShipAtPosition(i+(t.rotated?n:0)+a,e+(t.rotated?0:n)+o))return!1;return!0},this.checkShipAtPosition=function(t,i){return this.checkGrid(t,i,1)!==!1},this.checkGrid=function(i,e,s){return 0>i||0>e||i>=10||e>=10?!1:"undefined"==typeof s?t[i+10*e]:t[i+10*e][0]==s?t[i+10*e][1]:!1},this.setShipsRandomly=function(t){var i=this.Ships.getAll();for(var e in i){var s=this.setOneShipRandomly(i[e]);this.Ships.rotate(e,s.rotated),this.Ships.set(e,{x:s.x,y:s.y},t),this.update()}},this.setOneShipRandomly=function(t){var i=n.getRandom(0,1),e=n.getRandom(0,9),s=n.getRandom(0,9);return t.rotated=i,this.checkCollider(t,e,s)?{rotated:i,x:e,y:s}:this.setOneShipRandomly(t)},this.setCollider=function(t,i){var e=this.Ships.get(t),s=this.Ships.getPosition(t,i.offset),n=e.rotated?e.mast:1,a=e.rotated?1:e.mast;s.x<0&&(n+=s.x),s.y<0&&(a+=s.y),s.x+n>10&&(n-=s.x+n-10),s.y+a>10&&(a-=s.y+a-10),0>=n||0>=a?this.$.find(".collider").hide():this.$.find(".collider").css({top:33*Math.max(s.y,0)+1,left:33*Math.max(s.x,0)+1,width:30*(1==n?.95:1.05*n),height:30*(1==a?.95:1.05*a)}).removeClass("red-collider").addClass(this.checkCollider(e,s.x,s.y)?"":"red-collider").show()},this.hideCollider=function(){this.$.find(".collider").hide()},this.message=function(t,i,e){this.$.find(".message").length||this.$.append($("<div/>",{"class":"message"}));var s=this.$.find(".message");s.removeClass("boom").text(i),s.css({left:33*t.x+16.5-s.width()/2,top:33*t.y-s.height(),color:e?e:"#000"}).addClass("boom").one("webkitAnimationEnd oanimationend msAnimationEnd animationend",function(t){s.removeClass("boom")})},this.attackGrid=function(i,e){var s=this.checkGrid(i,e),n={x:i,y:e};switch(s[0]){case 0:return t[i+10*e]=[2,s[1]],this.mishit(n),this.message(n,"Pudło!","#de6a50"),[!1,!1];case 1:return t[i+10*e]=[3,1],this.fire(n,s[1]),this.Ships.dealDamage(s[1]),this.Ships.isDamaged(s[1])?(this.Ships.sink(s[1]),this.message(n,"Trafiony zatopiony!","lime"),[!0,!0,this.setMishitAroundShip(s[1])]):(this.message(n,"Trafiony!","lime"),[!0,!1]);case 2:case 3:return!1}return!1},this.fire=function(t,i){this.$.append($("<div/>",{"class":"fire","data-ship":i}).css({top:33*t.y-2,left:33*t.x}))},this.mishit=function(t,i){"undefined"==typeof i&&(i=!1),this.$.append($("<div/>",{"class":"mishit"}).css({top:33*t.y,left:33*t.x,opacity:i?.6:1}))},this.setMishitAroundShip=function(i){for(var e=this.Ships.get(i),s=[],n=0;n<e.mast;n++)for(var a=-1;1>=a;a++)for(var o=-1;1>=o;o++){var r={x:e.x+(e.rotated?n:0)+a,y:e.y+(e.rotated?0:n)+o},d=this.checkGrid(r.x,r.y,0);if(d!==!1){this.mishit(r,!0);var h=r.x+10*r.y;t[h]=[3,2],s.push(h)}}return s},this.init=function(){this.clear(),this.Ships=new s(this.$)},this.init()}},{"./Functions":4,"./Ships":7}],4:[function(t,i,e){i.exports=new function(){this.getRandom=function(t,i){return Math.floor(Math.random()*(i-t+1)+t)}}},{}],5:[function(t,i,e){var s=t("./Player"),n=t("./Functions");i.exports=function(t){var i,e,a=this;this.createListOfShips=function(){var t=$("<div/>",{"class":"choice"}),e=i.Field.Ships.getAll();for(var s in e)!function(s){var n={x:0,y:0};e[s].$.draggable({start:function(t,e){var a=parseInt($(this).css("left"),10),o=parseInt($(this).css("top"),10);n.x=(isNaN(a)?0:a)-e.position.left,n.y=(isNaN(o)?0:o)-e.position.top,i.Field.deleteShip(s)},drag:function(t,e){e.position.left+=n.x,e.position.top+=n.y,i.Field.setCollider(s,e)},stop:function(t,e){i.Field.setShip(s,e),i.Field.hideCollider()}}).dblclick(function(){i.Field.Ships.rotate(s)}).appendTo(t)}(s);return t},this.prepareArena=function(){i.Field.$.removeClass("start"),i.Field.Ships.disbaleDragging(),t.find("> *").not(i.Field.$).remove(),t.append(e.Field.$.addClass("start enemy-field").append($("<div/>",{"class":"marker"})).one("webkitAnimationEnd oanimationend msAnimationEnd animationend",function(){$(this).removeClass("start")})),i.addLabel(),e.addLabel(),e.addDamagedShips()},this.play=function(){if(!this.checkShipsBeforeStart())return alert("Sprawdź jeszcze raz ustawienie swoich statków!");if(this.prepareArena(),!i.move&&!e.move)switch(n.getRandom(0,1)){case 0:i.move=!0;break;case 1:e.move=!0}this.gameLoop(!0)},this.checkShipsBeforeStart=function(){if(!i.Field.update())return!1;var t=i.Field.Ships.getAll();for(var e in t)if(!i.Field.checkCollider(t[e]))return!1;return!0},this.gameLoop=function(t){if(i.move){if(t!==!0){var s=i.attack(t);if(!s)return e.giveRound(a.gameLoop,i.Field.$);e.isAI()&&e.AI.analyze(s)}if(a.detectEnd())return;i.giveRound(a.gameLoop,e.Field.$),i.move=!1,e.move=!0}else if(e.move){if(t!==!0&&!e.attack(t))return i.giveRound(a.gameLoop,e.Field.$);if(a.detectEnd())return;e.giveRound(a.gameLoop,i.Field.$),i.move=!0,e.move=!1}},this.detectEnd=function(){return i.gameOver?this.gameOver(e.getPlayer(),e.moves):e.gameOver?this.gameOver(i.getPlayer(),i.moves):!1},this.playAgain=function(){this.init()},this.gameOver=function(i,e){return t.empty().append($("<div/>",{"class":"gameover"}).append($("<h3/>",{text:"Koniec gry!"})).append($("<span/>",{text:"Zwyciężył(a)"})).append($("<h3/>",{text:i.name,"class":"winner "+(0===i.type?"me":"enemy")})).append($("<span/>",{"class":"winmoves",text:"W "+e+" ruchach"})).append($("<div/>",{"class":"button playagain"}).append($("<span/>",{text:"Zagraj ponownie","data-text":"Zagraj ponownie"})).click(this.playAgain.bind(this)).after("<br/>"))),!0},this.init=function(){i=new s({name:"Gracz 1",type:0}),e=new s({name:"Komputer",AI:!0,type:1}),t.empty().append(i.Field.$.addClass("my-field start").append($("<div/>",{"class":"collider"}))).append(this.createListOfShips()).append($("<div/>",{"class":"button set-randomly"}).append($("<span/>",{text:"Ustaw losowo","data-text":"Ustaw losowo"})).click(i.Field.setShipsRandomly.bind(i.Field))).append($("<div/>",{"class":"button start-game disabled"}).append($("<span/>",{text:"Start!","data-text":"Start!"})).click(this.play.bind(this)))}}},{"./Functions":4,"./Player":6}],6:[function(t,i,e){var s=t("./Field");i.exports=function(i){i=$.extend({AI:!1,type:0},i),this.Field,this.move=!1,this.moves=0,this.AI=null,this.gameOver=!1,this.giveRound=function(t,e){var s=e.find(".marker");if(0==i.type)e.bind("click mousemove mouseout",function(i){if("mouseout"==i.type)return void s.hide();var e={x:Math.floor((i.layerX+1)/33),y:Math.floor((i.layerY+1)/33)};return"click"==i.type?($(this).unbind("click mousemove"),s.hide(),void t(e)):void s.css({left:33*e.x,top:33*e.y}).show()});else if(this.isAI()){var n=this.AI.doAttack();setTimeout(function(){t(n)},800)}},this.attack=function(t){var i=this.Field.attackGrid(t.x,t.y);return i&&this.moves++,"undefined"!=typeof i[0]&&"undefined"!=typeof i[1]&&i[0]&&i[1]&&this.Field.Ships.allDamaged()&&(this.gameOver=!0),i},this.isAI=function(){return i.AI&&!!this.AI},this.addLabel=function(){var t=$("<div/>",{"class":"playerlabel "+(0==i.type?"me":"enemy")}).append($("<span/>",{text:i.name}));this.Field.$.after(t)},this.addDamagedShips=function(){var t=this.Field.Ships.getAll(),i=$("<div/>",{"class":"todamage"});for(var e in t)i.append(t[e].$.clone().removeClass("rotated"));this.Field.$.after(i)},this.getPlayer=function(t){return"undefined"!=typeof t?i[t]:i},this.init=function(){if(this.Field=new s,i.AI){this.Field.setShipsRandomly(!1);var e=t("./AI");this.AI=new e}},this.init()}},{"./AI":2,"./Field":3}],7:[function(t,i,e){i.exports=function(t){var i=this,e={1:{mast:5,"class":"ship5"},2:{mast:4,"class":"ship4"},3:{mast:3,"class":"ship31"},4:{mast:3,"class":"ship32"},5:{mast:2,"class":"ship2"}};this.get=function(t){return e[t]},this.getAll=function(){return e},this.rotate=function(t,s){return"undefined"!=typeof s?(e[t].$.removeClass("rotated").addClass(s?"rotated":""),void(e[t].rotated=s?!0:!1)):(e[t].$.toggleClass("rotated").one("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend",function(){var s=i.getPosition(t);e[t].x=s.x,e[t].y=s.y}),void(e[t].rotated=e[t].$.hasClass("rotated")))},this.reset=function(t){e[t].x=-1,e[t].y=-1},this.set=function(t,i,s){"undefined"==typeof s&&(s=!0),e[t].x=i.x,e[t].y=i.y,s&&this.setPosition(t)},this.setPosition=function(i){var s=e[i],n={x:s.x,y:s.y};return s.$.removeAttr("style"),Math.min(0,n.x,n.y)<0||Math.max(10,n.x+(s.rotated?s.mast:1),n.y+(s.rotated?1:s.mast))>10?(s.rotated&&this.rotate(i),s.$.parent()[0]===t[0]&&s.$.detach().appendTo(t.next("div")),s.$.css("position","relative"),void this.reset(i)):(s.$.parent()[0]!==t[0]&&s.$.detach().appendTo(t),n=this.fixPosRotatedShip(n,i),void s.$.css({top:33*n.y,left:33*n.x}))},this.getPosition=function(i,s,n){"undefined"==typeof s&&(s=e[i].$.offset()),"undefined"==typeof n&&(n=!1);var a={x:Math.round((s.left-t.offset().left)/33),y:Math.round((s.top-t.offset().top)/33)};return n?this.fixPosRotatedShip(a,i):a},this.fixPosRotatedShip=function(t,i){if(!e[i].rotated)return t;var s=Math.floor(e[i].mast/2);return t.x+=s,t.y-=s,e[i].mast%2==0&&t.x--,t},this.disbaleDragging=function(){for(var t in e)e[t].$.draggable("destroy")},this.dealDamage=function(t){return++e[t].damage},this.isDamaged=function(t){return e[t].damage>=e[t].mast},this.allDamaged=function(){for(var t in e)if(!this.isDamaged(t))return!1;return!0},this.sink=function(i){e[i].$.parent().length||(this.setPosition(i),$(".todamage").find("."+e[i]["class"]).css({opacity:.3})),t.find(".fire[data-ship='"+i+"']").remove(),e[i].$.css("opacity",.3)},this.init=function(){for(var t in e)e[t].$=$("<div/>",{"class":"ship "+e[t]["class"]}),e[t].x=-1,e[t].y=-1,e[t].rotated=!1,e[t].damage=0},this.init()}},{}]},{},[1]);
